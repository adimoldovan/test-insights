<html lang="">

<head>
    <title>Test insights</title>
    <style>
        html {
            font-family: sans-serif;
            -ms-text-size-adjust: 100%;
            -webkit-text-size-adjust: 100%;
            color: #666666;
        }

        body {
            margin: 0
        }

        table {
            border-collapse: collapse;
        }

        th {
            text-align: left;
            padding: 15px;
            border-bottom: 2px solid #ddd;
        }

        .result-row:hover {
            background-color: #f5f5f5;
        }

        td {
            border-bottom: 1px dotted #ddd;
            padding: 15px;
            font-weight: lighter;
        }

        small {
            color: #999
        }

        .status {
            border: 0 solid black;
            border-radius: 5px;
            padding: 10px;
            opacity: 0.8;
            float: left;
            margin: 2px;
            cursor: hand;
            text-align: center;
        }

        .status:hover {
            opacity: 1;
        }

        .passed {
            color: white;
            background-color: olivedrab;
        }

        .upper {
            text-transform: uppercase;
        }

        .failed,
        .broken {
            color: white;
            background-color: indianred;
        }


        /* Tooltip container */
        .tooltip {
            position: relative;
            display: inline-block;
            width: 15px;
        }

        /* Tooltip text */
        .tooltip .tooltiptext {
            min-width: 450px;
            visibility: hidden;
            background-color: indianred;
            color: #fff;
            padding: 15px;
            border-radius: 6px;

            position: absolute;
            z-index: 1;
            top: 100%;
            margin-left: -400px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .tooltiptext {
            text-align: left;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        .stacktrace {
            font-family: Monospace, serif;
        }

        hr {
            border-top: 1px dotted red;
        }

        header {
            border-bottom: 1px dotted #ddd;
            padding: 15px;
            background-color: #f5f5f5;

        }

        h2 {
            font-weight: lighter;
            text-transform: uppercase;
        }

        h4 {
            font-weight: lighter;
        }

        input {
            border: solid 1px #ccc;
            border-radius: 5px;
            padding: 7px 14px;
            margin-bottom: 10px;
            width: 450px;
        }

        input:focus {
            outline: none;
            border-color: #aaa;
        }
    </style>
</head>

<body>
<header>
    <h2>Functional tests insights</h2>
    <h4>Generated on ${generated_date}</h4>
</header>
<div id="specs" style="overflow-x:auto;">
    <table>
        <thead>
        <tr>
            <td colspan=3>
                <ul>
                    <li>Total test cases: ${data['meta']['test_cases']}</li>
                    <li>Test cases with at least one failed run: ${data['meta']['failed_test_cases']}</li>
                    <li>Total runs: ${data['meta']['total_runs']}</li>
                    <li>Total failed runs: ${data['meta']['total_failed_runs']} (${data['meta']['failure_rate']})</li>
                </ul>
            </td>
        </tr>
        <tr>
            <td colspan=3><label>
                Search: <input class="search" placeholder="..."/>
            </label></td>
        </tr>
        <tr>
            <th class="sort" data-sort="name">Name
                <svg xmlns="http://www.w3.org/2000/svg" height="12" viewBox="0 0 24 24" width="12">
                    <path d="M3 18h6v-2H3v2zM3 6v2h18V6H3zm0 7h12v-2H3v2z"/>
                    <path d="M0 0h24v24H0z" fill="none"/>
                </svg>
            </th>
            <th class="sort" data-sort="failure-rate">Failures
                <svg xmlns="http://www.w3.org/2000/svg" height="12" viewBox="0 0 24 24" width="12">
                    <path d="M3 18h6v-2H3v2zM3 6v2h18V6H3zm0 7h12v-2H3v2z"/>
                    <path d="M0 0h24v24H0z" fill="none"/>
                </svg>
            </th>
            <th>Results</th>
        </tr>
        </thead>
        <tbody class="list">
        % for key in data['tests']:
        <tr class="result-row">
            <%
            segments = key.split('.')
            name = segments[segments.__len__() - 1]
            segments.pop(segments.__len__() - 1)
            [segments.pop(0) for n in range(0,4)]
            path = '.'.join(segments)
            %>
            <td class="name"><span>${name}</span><br><small>${path}</small></td>
            <td class="failure-rate">${data['tests'][key]['failure_rate']} %</td>
            <td>
                % for result in data['tests'][key]['results']:
                <div class="tooltip status ${result['status']}">
                    <span class="upper">${result['status'][0]}</span>
                    <div id="details-${result['uuid']}" class="tooltiptext">
                        <%
                        import datetime
                        end = datetime.datetime.fromtimestamp(result['start']/1000).isoformat(timespec='seconds')
                        stop = datetime.datetime.fromtimestamp(result['stop']/1000)
                        start = datetime.datetime.fromtimestamp(result['start']/1000)
                        tdelta = stop - start
                        %>
                        <div class="clipboard">${end}, took ${tdelta}</div>
                        <div><span class="clipboard">Results id: ${result['uuid']}</span></div>
                        <hr>
                        <div class="stacktrace clipboard">${result['trace'] | h}</div>
                    </div>
                </div>
                % endfor
            </td>
        </tr>
        % endfor
        </tbody>
    </table>
</div>
<script>
    let coll = document.getElementsByClassName("clipboard");
    let i;

    for (i = 0; i < coll.length; i++) {
        coll[i].addEventListener("click", function () {
            ta = document.createElement('textarea');
            ta.value = this.innerText;
            ta.setAttribute('readonly', '');
            ta.style.position = 'absolute';
            ta.style.left = '-9999px';
            document.body.appendChild(ta);
            ta.select();
            document.execCommand('copy');
            document.body.removeChild(ta);
        });
    }
</script>
<script src="list.min.js"></script>
<script>
    let options = {
        valueNames: ['name', 'failure-rate']
    };

    let specList = new List('specs', options);
</script>
</body>

</html>
