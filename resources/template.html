<html lang="">

<head>
    <title>Test insights</title>
    <link rel="stylesheet" href="insights.css"/>
</head>

<body>
<header>
    <h2>Functional tests insights</h2>
    <h4>Generated on ${generated_date}</h4>
</header>
<table id="specs">
    <thead>
    <tr>
        <td colspan=3>
            <ul>
                <li>Total affected test cases: ${data['meta']['affected_test_cases']}</li>
                <li>Test cases with at least one failed run: ${data['meta']['failed_test_cases']}</li>
                <li>Solved test cases: ${data['meta']['solved_test_cases']}</li>
                <li>Solved results: ${data['meta']['solved_results']}</li>
                <li>Total runs: ${data['meta']['total_runs']}</li>
                <li>Total failed runs: ${data['meta']['total_failed_runs']} (${data['meta']['failure_rate']})</li>
            </ul>
        </td>
    </tr>
    <tr>
        <td colspan=3><label>
            Search: <input class="search" placeholder="..."/>
        </label>
            <input id="filterNoFailures" type="checkbox" checked/>
            <label for="filterNoFailures">Hide tests with 0% failure rate</label>
        </td>
    </tr>
    <tr>
        <th class="sort" data-sort="name">Name
            <svg xmlns="http://www.w3.org/2000/svg" height="12" viewBox="0 0 24 24" width="12">
                <path d="M3 18h6v-2H3v2zM3 6v2h18V6H3zm0 7h12v-2H3v2z"/>
                <path d="M0 0h24v24H0z" fill="none"/>
            </svg>
        </th>
        <th class="sort" data-sort="failureRate">Failure rate
            <svg xmlns="http://www.w3.org/2000/svg" height="12" viewBox="0 0 24 24" width="12">
                <path d="M3 18h6v-2H3v2zM3 6v2h18V6H3zm0 7h12v-2H3v2z"/>
                <path d="M0 0h24v24H0z" fill="none"/>
            </svg>
        </th>
        <th>Results</th>
    </tr>
    </thead>
    <tbody class="list">
    % for key in data['tests']:
    <tr class="result-row">
        <%
        segments = key.split('.')
        name = segments[segments.__len__() - 1]
        segments.pop(segments.__len__() - 1)
        [segments.pop(0) for n in range(0,4)]
        path = '.'.join(segments)
        %>
        <td class="name"><span>${name}</span><br><small>${path}</small></td>
        <td class="failureRate">${data['tests'][key]['failure_rate']} %</td>
        <td>
            % for result in data['tests'][key]['results']:
            <div class="tooltip status ${result['status']}">
                <span class="upper">${result['status'][0]}</span>
                <div id="details-${result['uuid']}" class="tooltiptext">
                    <%
                    import datetime
                    end = datetime.datetime.fromtimestamp(result['start']/1000).isoformat(timespec='seconds')
                    stop = datetime.datetime.fromtimestamp(result['stop']/1000)
                    start = datetime.datetime.fromtimestamp(result['start']/1000)
                    tdelta = stop - start
                    %>
                    <div class="clipboard">${end}, took ${tdelta}</div>
                    <div><span class="clipboard">Results id: ${result['uuid']}</span></div>
                    <hr>
                    <div class="stacktrace clipboard">${result['trace'] | h}</div>
                </div>
            </div>
            % endfor
        </td>
    </tr>
    % endfor
    </tbody>
</table>
<script src="list.min.js"></script>
<script src="insights.js"></script>
</body>

</html>
